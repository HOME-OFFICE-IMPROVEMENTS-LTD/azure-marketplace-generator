{
    "$schema": "https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
    "handler": "Microsoft.Azure.CreateUIDef",
    "version": "0.1.2-preview",
    "parameters": {
        "config": {
            "isWizard": false,
            "basics": {
                "description": "**Storage Lifecycle Management** by Home & Office Improvements Ltd\n\nEnterprise Azure Storage solution with automated lifecycle policies, cost optimization, and advanced security features.",
                "subscription": {
                    "constraints": {
                        "validations": [
                            {
                                "permission": "Microsoft.Storage/storageAccounts/write",
                                "message": "Must have permission to create storage accounts"
                            }
                        ]
                    }
                },
                "resourceGroup": {
                    "constraints": {
                        "validations": [
                            {
                                "isValid": "[not(contains(resourceGroup().name, 'temp'))]",
                                "message": "Resource group name cannot contain 'temp'"
                            }
                        ]
                    }
                },
                "location": {
                    "visible": true,
                    "allowedValues": [
                        "eastus",
                        "eastus2", 
                        "westus",
                        "westus2",
                        "westeurope",
                        "northeurope"
                    ]
                }
            }
        },
        "basics": [],
        "steps": [
            {
                "name": "storageConfig",
                "label": "Storage Configuration",
                "subLabel": {
                    "preValidation": "Configure storage account settings",
                    "postValidation": "Storage configuration complete"
                },
                "bladeTitle": "Storage Settings",
                "elements": [
                    {
                        "name": "storageAccountPrefix",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Storage Account Name Prefix",
                        "defaultValue": "flexiblestoragedemocfdr6",
                        "toolTip": "Prefix for storage account name (lowercase letters and numbers only)",
                        "constraints": {
                            "required": true,
                            "regex": "^[a-z0-9]{3,11}$",
                            "validationMessage": "Prefix must be 3-11 characters, lowercase letters and numbers only"
                        }
                    },
                    {
                        "name": "storageAccountType",
                        "type": "Microsoft.Common.DropDown",
                        "label": "Storage Account Type",
                        "defaultValue": "Standard locally redundant storage (Standard_LRS)",
                        "toolTip": "Select the replication option for your storage account",
                        "constraints": {
                            "required": true,
                            "allowedValues": [
                                {
                                    "label": "Standard locally redundant storage (Standard_LRS)",
                                    "value": "Standard_LRS"
                                },
                                {
                                    "label": "Standard geo-redundant storage (Standard_GRS)",
                                    "value": "Standard_GRS"
                                },
                                {
                                    "label": "Standard read-access geo-redundant storage (Standard_RAGRS)",
                                    "value": "Standard_RAGRS"
                                },
                                {
                                    "label": "Premium locally redundant storage (Premium_LRS)",
                                    "value": "Premium_LRS"
                                }
                            ]
                        }
                    }
                ]
            },
            {
                "name": "serviceSelection",
                "label": "Service Selection",
                "subLabel": {
                    "preValidation": "Choose your storage services",
                    "postValidation": "Services selected"
                },
                "bladeTitle": "Storage Services",
                "elements": [
                    {
                        "name": "serviceInfo",
                        "type": "Microsoft.Common.InfoBox",
                        "visible": true,
                        "options": {
                            "icon": "Info",
                            "text": "Azure Storage Account offers multiple services beyond basic blob storage. Select the services you need for your solution. Each service unlocks different business capabilities and use cases."
                        }
                    },
                    {
                        "name": "enableStaticWebsite",
                        "type": "Microsoft.Common.CheckBox",
                        "label": "Enable Static Website Hosting",
                        "defaultValue": false,
                        "toolTip": "Host static websites directly from your storage account - perfect for web apps, documentation sites, and frontend applications"
                    },
                    {
                        "name": "websiteConfiguration",
                        "type": "Microsoft.Common.Section",
                        "label": "Website Configuration",
                        "visible": "[steps('serviceSelection').enableStaticWebsite]",
                        "elements": [
                            {
                                "name": "websiteIndexDocument",
                                "type": "Microsoft.Common.TextBox",
                                "label": "Index Document",
                                "defaultValue": "index.html",
                                "toolTip": "Default document for your website root",
                                "constraints": {
                                    "required": true,
                                    "regex": "^.{1,100}\\.(html|htm)$",
                                    "validationMessage": "Must be an HTML file (max 100 characters)"
                                }
                            },
                            {
                                "name": "websiteErrorDocument",
                                "type": "Microsoft.Common.TextBox",
                                "label": "Error Document",
                                "defaultValue": "404.html",
                                "toolTip": "Custom error page for 404 errors",
                                "constraints": {
                                    "required": true,
                                    "regex": "^.{1,100}\\.(html|htm)$",
                                    "validationMessage": "Must be an HTML file (max 100 characters)"
                                }
                            }
                        ]
                    },
                    {
                        "name": "enableTables",
                        "type": "Microsoft.Common.CheckBox",
                        "label": "Enable Table Storage (NoSQL Database)",
                        "defaultValue": false,
                        "toolTip": "Add NoSQL database capabilities - ideal for structured data, user profiles, device data, and metadata storage"
                    },
                    {
                        "name": "enableQueues",
                        "type": "Microsoft.Common.CheckBox", 
                        "label": "Enable Queue Storage (Message Processing)",
                        "defaultValue": false,
                        "toolTip": "Enable message queuing for asynchronous processing, task scheduling, and building event-driven architectures"
                    },
                    {
                        "name": "enableFileShares",
                        "type": "Microsoft.Common.CheckBox",
                        "label": "Enable File Storage (Network Drives)",
                        "defaultValue": false,
                        "toolTip": "Create network file shares accessible via SMB protocol - perfect for shared application data and legacy application migration"
                    },
                    {
                        "name": "businessModelInfo",
                        "type": "Microsoft.Common.InfoBox",
                        "visible": "[or(or(steps('serviceSelection').enableStaticWebsite, steps('serviceSelection').enableTables), or(steps('serviceSelection').enableQueues, steps('serviceSelection').enableFileShares))]",
                        "options": {
                            "icon": "Info",
                            "text": "ðŸ’¡ Business Model Tip: With multiple services enabled, you can offer different pricing tiers - Basic (blob only), Professional (includes web hosting), Enterprise (full multi-service platform). This creates natural upgrade paths and higher customer lifetime value."
                        }
                    }
                ]
            }
        ],
        "outputs": {
            "storageAccountNamePrefix": "[steps('storageConfig').storageAccountPrefix]",
            "storageAccountType": "[steps('storageConfig').storageAccountType]",
            "location": "[location()]",
            "enableStaticWebsite": "[steps('serviceSelection').enableStaticWebsite]",
            "enableTables": "[steps('serviceSelection').enableTables]",
            "enableQueues": "[steps('serviceSelection').enableQueues]",
            "enableFileShares": "[steps('serviceSelection').enableFileShares]",
            "websiteIndexDocument": "[if(steps('serviceSelection').enableStaticWebsite, steps('serviceSelection').websiteConfiguration.websiteIndexDocument, 'index.html')]",
            "websiteErrorDocument": "[if(steps('serviceSelection').enableStaticWebsite, steps('serviceSelection').websiteConfiguration.websiteErrorDocument, '404.html')]"
        }
    }
}