{
  "$schema": "https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
  "handler": "Microsoft.Azure.CreateUIDef",
  "version": "0.1.2-preview",
  "parameters": {
    "basics": [
      {
        "name": "resourceGroup",
        "type": "Microsoft.Common.Section",
        "label": "Resource Group",
        "elements": [
          {
            "name": "resourceGroupInfo",
            "type": "Microsoft.Common.InfoBox",
            "visible": true,
            "options": {
              "icon": "Info",
              "text": "This networking infrastructure will be deployed to the selected resource group."
            }
          }
        ]
      }
    ],
    "steps": [
      {
        "name": "networkConfig",
        "label": "Network Configuration",
        "elements": [
          {
            "name": "vnetName",
            "type": "Microsoft.Common.TextBox",
            "label": "Virtual Network Name",
            "placeholder": "Enter virtual network name",
            "defaultValue": "myVNet",
            "toolTip": "Name for the virtual network",
            "constraints": {
              "required": true,
              "regex": "^[a-zA-Z0-9-_]{1,80}$",
              "validationMessage": "Virtual network name must be 1-80 characters, letters, numbers, hyphens, and underscores only"
            },
            "visible": true
          },
          {
            "name": "location",
            "type": "Microsoft.Common.DropDown",
            "label": "Location",
            "placeholder": "Select location",
            "defaultValue": "East US",
            "toolTip": "Location for networking resources",
            "constraints": {
              "allowedValues": [
                {
                  "label": "East US",
                  "value": "eastus"
                },
                {
                  "label": "West US 2",
                  "value": "westus2"
                },
                {
                  "label": "Central US",
                  "value": "centralus"
                },
                {
                  "label": "North Europe",
                  "value": "northeurope"
                },
                {
                  "label": "West Europe",
                  "value": "westeurope"
                }
              ],
              "required": true
            },
            "visible": true
          },
          {
            "name": "vnetAddressPrefix",
            "type": "Microsoft.Common.TextBox",
            "label": "Virtual Network Address Space",
            "placeholder": "Enter CIDR notation (e.g., 10.0.0.0/16)",
            "defaultValue": "10.0.0.0/16",
            "toolTip": "Address space for the virtual network in CIDR notation",
            "constraints": {
              "required": true,
              "regex": "^([0-9]{1,3}\\.){3}[0-9]{1,3}/[0-9]{1,2}$",
              "validationMessage": "Must be a valid CIDR notation (e.g., 10.0.0.0/16)"
            },
            "visible": true
          },
          {
            "name": "subnetName",
            "type": "Microsoft.Common.TextBox",
            "label": "Subnet Name",
            "placeholder": "Enter subnet name",
            "defaultValue": "default",
            "toolTip": "Name for the default subnet",
            "constraints": {
              "required": true,
              "regex": "^[a-zA-Z0-9-_]{1,80}$",
              "validationMessage": "Subnet name must be 1-80 characters, letters, numbers, hyphens, and underscores only"
            },
            "visible": true
          },
          {
            "name": "subnetAddressPrefix",
            "type": "Microsoft.Common.TextBox",
            "label": "Subnet Address Space",
            "placeholder": "Enter CIDR notation (e.g., 10.0.1.0/24)",
            "defaultValue": "10.0.1.0/24",
            "toolTip": "Address space for the subnet in CIDR notation",
            "constraints": {
              "required": true,
              "regex": "^([0-9]{1,3}\\.){3}[0-9]{1,3}/[0-9]{1,2}$",
              "validationMessage": "Must be a valid CIDR notation (e.g., 10.0.1.0/24)"
            },
            "visible": true
          }
        ]
      },
      {
        "name": "securityConfig",
        "label": "Security Configuration",
        "elements": [
          {
            "name": "nsgName",
            "type": "Microsoft.Common.TextBox",
            "label": "Network Security Group Name",
            "placeholder": "Enter NSG name",
            "defaultValue": "myNSG",
            "toolTip": "Name for the network security group",
            "constraints": {
              "required": true,
              "regex": "^[a-zA-Z0-9-_]{1,80}$",
              "validationMessage": "NSG name must be 1-80 characters, letters, numbers, hyphens, and underscores only"
            },
            "visible": true
          },
          {
            "name": "allowedSshSourcePrefix",
            "type": "Microsoft.Common.TextBox",
            "label": "Allowed SSH Source",
            "placeholder": "Enter IP address or CIDR (e.g., 203.0.113.0/24)",
            "defaultValue": "*",
            "toolTip": "Source IP address or CIDR range allowed for SSH access (* for any)",
            "constraints": {
              "required": true,
              "regex": "^(\\*|([0-9]{1,3}\\.){3}[0-9]{1,3}(/[0-9]{1,2})?)$",
              "validationMessage": "Must be '*', IP address, or CIDR notation"
            },
            "visible": true
          },
          {
            "name": "allowedHttpSourcePrefix",
            "type": "Microsoft.Common.TextBox",
            "label": "Allowed HTTP/HTTPS Source",
            "placeholder": "Enter IP address or CIDR (e.g., 203.0.113.0/24)",
            "defaultValue": "*",
            "toolTip": "Source IP address or CIDR range allowed for HTTP/HTTPS access (* for any)",
            "constraints": {
              "required": true,
              "regex": "^(\\*|([0-9]{1,3}\\.){3}[0-9]{1,3}(/[0-9]{1,2})?)$",
              "validationMessage": "Must be '*', IP address, or CIDR notation"
            },
            "visible": true
          },
          {
            "name": "enableDdosProtection",
            "type": "Microsoft.Common.OptionsGroup",
            "label": "Enable DDoS Protection",
            "defaultValue": "No",
            "toolTip": "Enable DDoS Protection Standard (additional cost applies)",
            "constraints": {
              "allowedValues": [
                {
                  "label": "Yes",
                  "value": true
                },
                {
                  "label": "No",
                  "value": false
                }
              ],
              "required": true
            },
            "visible": true
          },
          {
            "name": "enableVmProtection",
            "type": "Microsoft.Common.OptionsGroup",
            "label": "Enable VM Protection",
            "defaultValue": "Yes",
            "toolTip": "Enable VM protection policies",
            "constraints": {
              "allowedValues": [
                {
                  "label": "Yes",
                  "value": true
                },
                {
                  "label": "No",
                  "value": false
                }
              ],
              "required": true
            },
            "visible": true
          }
        ]
      },
      {
        "name": "loadBalancerConfig",
        "label": "Load Balancer Configuration",
        "elements": [
          {
            "name": "createLoadBalancer",
            "type": "Microsoft.Common.OptionsGroup",
            "label": "Create Load Balancer",
            "defaultValue": "Yes",
            "toolTip": "Create a load balancer with public IP",
            "constraints": {
              "allowedValues": [
                {
                  "label": "Yes",
                  "value": true
                },
                {
                  "label": "No",
                  "value": false
                }
              ],
              "required": true
            },
            "visible": true
          },
          {
            "name": "loadBalancerName",
            "type": "Microsoft.Common.TextBox",
            "label": "Load Balancer Name",
            "placeholder": "Enter load balancer name",
            "defaultValue": "myLoadBalancer",
            "toolTip": "Name for the load balancer",
            "constraints": {
              "required": true,
              "regex": "^[a-zA-Z0-9-_]{1,80}$",
              "validationMessage": "Load balancer name must be 1-80 characters, letters, numbers, hyphens, and underscores only"
            },
            "visible": "[steps('loadBalancerConfig').createLoadBalancer]"
          },
          {
            "name": "publicIpName",
            "type": "Microsoft.Common.TextBox",
            "label": "Public IP Name",
            "placeholder": "Enter public IP name",
            "defaultValue": "myPublicIP",
            "toolTip": "Name for the public IP address",
            "constraints": {
              "required": true,
              "regex": "^[a-zA-Z0-9-_]{1,80}$",
              "validationMessage": "Public IP name must be 1-80 characters, letters, numbers, hyphens, and underscores only"
            },
            "visible": "[steps('loadBalancerConfig').createLoadBalancer]"
          }
        ]
      }
    ],
    "outputs": {
      "vnetName": "[steps('networkConfig').vnetName]",
      "location": "[steps('networkConfig').location]",
      "vnetAddressPrefix": "[steps('networkConfig').vnetAddressPrefix]",
      "subnetName": "[steps('networkConfig').subnetName]",
      "subnetAddressPrefix": "[steps('networkConfig').subnetAddressPrefix]",
      "nsgName": "[steps('securityConfig').nsgName]",
      "allowedSshSourcePrefix": "[steps('securityConfig').allowedSshSourcePrefix]",
      "allowedHttpSourcePrefix": "[steps('securityConfig').allowedHttpSourcePrefix]",
      "enableDdosProtection": "[steps('securityConfig').enableDdosProtection]",
      "enableVmProtection": "[steps('securityConfig').enableVmProtection]",
      "createLoadBalancer": "[steps('loadBalancerConfig').createLoadBalancer]",
      "loadBalancerName": "[steps('loadBalancerConfig').loadBalancerName]",
      "publicIpName": "[steps('loadBalancerConfig').publicIpName]"
    }
  }
}