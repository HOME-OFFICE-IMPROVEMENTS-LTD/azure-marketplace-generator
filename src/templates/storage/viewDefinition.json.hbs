{
    "$schema": "https://schema.management.azure.com/schemas/viewdefinition/0.0.1-preview/ViewDefinition.json#",
    "contentVersion": "1.0.0.0",
    "metadata": {
        "_generator": {
            "name": "Azure Marketplace Generator", 
            "version": "0.1.0"
        },
        "description": "Post-deployment view for {{name}} by {{publisher}}"
    },
    "views": [
        {
            "kind": "Overview",
            "properties": {
                "header": "{{name}} - Storage Account Overview",
                "description": "Monitor and manage your deployed storage account",
                "commands": [
                    {
                        "displayName": "Open Storage Account",
                        "path": "storageAccount",
                        "icon": "MsPortalFx.Base.Images.Browse"
                    }
                ]
            }
        },
        {
            "kind": "CustomResources",
            "properties": {
                "displayName": "Storage Resources", 
                "version": "1.0.0.0",
                "resourceType": "Microsoft.Storage/storageAccounts",
                "createUIDefinition": {},
                "commands": [
                    {
                        "displayName": "Browse Storage Account",
                        "path": "storageAccount/browse",
                        "icon": "MsPortalFx.Base.Images.Browse"
                    },
                    {
                        "displayName": "Storage Keys", 
                        "path": "storageAccount/keys",
                        "icon": "MsPortalFx.Base.Images.Key"
                    },
                    {
                        "displayName": "Containers",
                        "path": "storageAccount/containers", 
                        "icon": "MsPortalFx.Base.Images.Folder"
                    }
                ]
            }
        },
        {
            "kind": "Properties",
            "properties": {
                "displayName": "Security Status",
                "version": "1.0.0.0",
                "items": [
                    {
                        "displayName": "Public Access Blocked",
                        "value": "[if(outputs('securityStatus').publicAccessBlocked, '✅ Yes (Secure)', '⚠️ No')]"
                    },
                    {
                        "displayName": "TLS Version",
                        "value": "[outputs('securityStatus').tlsVersion]"
                    },
                    {
                        "displayName": "HTTPS Only",
                        "value": "[if(outputs('securityStatus').httpsOnly, '✅ Enabled', '⚠️ Disabled')]"
                    },
                    {
                        "displayName": "Public Network Access",
                        "value": "[outputs('securityStatus').publicNetworkAccess]"
                    },
                    {
                        "displayName": "Shared Key Authentication",
                        "value": "[if(outputs('securityStatus').sharedKeyAllowed, '⚠️ Allowed', '✅ Disabled (Secure)')]"
                    },
                    {
                        "displayName": "OAuth Default",
                        "value": "[if(outputs('securityStatus').oauthDefault, '✅ Enabled', 'Disabled')]"
                    },
                    {
                        "displayName": "Infrastructure Encryption",
                        "value": "[if(outputs('securityStatus').infrastructureEncryption, '✅ Enabled (Double Encryption)', 'Single Layer')]"
                    }
                ]
            }
        },
        {
            "kind": "Properties",
            "properties": {
                "displayName": "Data Protection Status",
                "version": "1.0.0.0",
                "items": [
                    {
                        "displayName": "Blob Soft Delete",
                        "value": "[if(outputs('dataProtectionStatus').blobSoftDelete.enabled, concat('✅ Enabled (', string(outputs('dataProtectionStatus').blobSoftDelete.retentionDays), ' days)'), '⚠️ Disabled')]"
                    },
                    {
                        "displayName": "Container Soft Delete",
                        "value": "[if(outputs('dataProtectionStatus').containerSoftDelete.enabled, concat('✅ Enabled (', string(outputs('dataProtectionStatus').containerSoftDelete.retentionDays), ' days)'), '⚠️ Disabled')]"
                    },
                    {
                        "displayName": "Blob Versioning",
                        "value": "[if(outputs('dataProtectionStatus').versioning, '✅ Enabled', 'Disabled')]"
                    },
                    {
                        "displayName": "Change Feed (Audit Log)",
                        "value": "[if(outputs('dataProtectionStatus').changeFeed, '✅ Enabled', 'Disabled')]"
                    },
                    {
                        "displayName": "Last Access Time Tracking",
                        "value": "[if(outputs('dataProtectionStatus').lastAccessTimeTracking, '✅ Enabled', 'Disabled')]"
                    }
                ]
            }
        },
        {
            "kind": "Metrics",
            "properties": {
                "displayName": "Storage Metrics",
                "version": "1.0.0.0", 
                "charts": [
                    {
                        "displayName": "Storage Usage",
                        "chartType": "Line",
                        "metrics": [
                            {
                                "resourceMetadata": {
                                    "id": "[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Storage/storageAccounts/', outputs('storageAccountName'))]"
                                },
                                "name": "UsedCapacity",
                                "aggregationType": "Average",
                                "namespace": "Microsoft.Storage/storageAccounts",
                                "displayName": "Used Capacity"
                            }
                        ]
                    },
                    {
                        "displayName": "Transaction Count",
                        "chartType": "Line", 
                        "metrics": [
                            {
                                "resourceMetadata": {
                                    "id": "[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Storage/storageAccounts/', outputs('storageAccountName'))]"
                                },
                                "name": "Transactions",
                                "aggregationType": "Total",
                                "namespace": "Microsoft.Storage/storageAccounts/blobServices",
                                "displayName": "Total Transactions"
                            }
                        ]
                    }
                ]
            }
        }
    ]
}